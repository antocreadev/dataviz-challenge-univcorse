name: 🎉 Post Congrats on Successful Build 🎉

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: 🔍 Checkout code
        uses: actions/checkout@v2

      - name: 📦 Install dependencies
        run: npm install

      - name: 🚀 Build the project
        run: npm run build

      - name: 🎊 Send congratulatory GIF to Discord
        if: success()
        run: |
          echo "📬 Envoie des messages à Discord..."

          COMMIT_MESSAGES=$(git log -1 --pretty=format:'%s')
          
          curl -X POST -H "Content-Type: application/json" \
          -d "{
                \"content\": \"🐙📈⚡️ Ao Frate ! J'ai mis à jour la branch **main** ! Va voir c'est toc de bien ! ⚡️📈🐙\n\n**Derniers changements :**\n${COMMIT_MESSAGES}\",
                \"embeds\": [
                  {
                    \"title\": \"🎈 C'est la fête ! 🎈\",
                    \"description\": \"Une petite image pour t'encourager à aller voir au fada ! 🥳\",
                    \"image\": {
                      \"url\": \"https://media.giphy.com/media/l0MYt5jPR6QX5pnqM/giphy.gif\"
                    }
                  }
                ]
              }" \
          "${{ secrets.DISCORD_WEBHOOK_URL }}"
